(()=>{window.Audit=window.Audit||{};Audit.Common=Audit.Common||{};function Ve(){Audit.Common.Utilities=new Audit.Common.NewUtilities,Audit.Common.Init()}Audit.Common.Init=function(){};Audit.Common.NewUtilities=function(){var C=_spPageContextInfo.webServerRelativeUrl,g="AuditRequests",f="AuditRequests",_="AuditRequestsInternal",G="AuditRequestsInternal",k="AuditResponses",x="AuditResponses",B="AuditRequestDocs",M="AuditRequestDocs",q="AuditCoverSheets",H="AuditCoverSheets",V="AuditResponseDocs",j="AuditResponseDocs",Q="AuditResponseDocsEA",K="AuditResponseDocsEA",Y="AuditOrganizations",W="AuditOrganizations",J="AuditEmails",Z="AuditEmails",X="AuditBulkResponses",z="AuditBulkResponses",ee="AuditBulkPermissions",te="AuditBulkPermissions",ne="CGFS Special Access1",ie="CGFS Special Access2",re="Quality Assurance",oe="External Auditors",S=null,h=null,R=null;function se(e=!1){if(e){location.href=location.pathname;return}var t=location.pathname;if($("#tabs").html()!=null&&$("#tabs").html()!=""){var n=0;try{n=$("#tabs").tabs("option","active")}catch{}if(t+="?Tab="+n,n==0&&$("#ddlResponseName").val()!="")t+="&ResNum="+$("#ddlResponseName").val();else if(n==1){var i=$("#ddlResponsesOpen").val(),r=$("#ddlResponsesProcessed").val();i!=null&&i!=""?t+="&ResNum="+i:r!=null&&r!=""&&(t+="&ResNum="+r)}location.href=t}else location.reload()}function ae(){var e=new Date;$("#divLoading").text("Loaded at "+e.format("MM/dd/yyyy hh:mm tt"))}function le(){var e=GetUrlKeyValue("Tab");e!=null&&e!=""&&$("#tabs").tabs("option","active",e);var t=!1,n=GetUrlKeyValue("ResNum");n!=null&&n!=""&&(e==0?$("#ddlResponseName option[value='"+n+"']").length>0&&($("#ddlResponseName").val(n).change(),t=!0):$("#ddlResponsesOpen option[value='"+n+"']").length>0?$("#ddlResponsesOpen").val(n).change():$("#ddlResponsesProcessed option[value='"+n+"']").length>0&&$("#ddlResponsesProcessed").val(n).change()),t||$(".sr-response-item").show()}function ue(e,t){var n=0,i=0,r=0,s=0,o=0,a=$(".sr-response-item");a.each(function(){var l=$.trim($(this).find(".sr-response-requestStatus").text()),u=$.trim($(this).find(".sr-response-status").text());(u==e||u==t)&&(l=="Open"||l=="ReOpened")&&($(this).addClass("highlighted"),n++,u==e?s++:u==t&&o++,l=="Open"?i++:l=="ReOpened"&&r++)}),n>0?($("#lblStatusReportResponsesMsg").html("<span class='ui-icon ui-icon-alert'></span>There are "+n+" Responses pending your review"),s>0&&o==0?$("#ddlResponseStatus").val(e).change():o>0&&s==0&&$("#ddlResponseStatus").val(t).change()):$("#lblStatusReportResponsesMsg").html("<span class='ui-icon ui-icon-circle-check'></span>There are 0 Responses pending your review")}function ce(e){h=new Array;for(var t=e.getEnumerator();t.moveNext();){var n=t.get_current(),i=n.get_id(),r=n.get_loginName(),s=n.get_title(),o=new Object;o.ID=i,o.loginName=r,o.title=s,o.group=n,h.push(o)}}function de(e){var t=null;if(h!=null){for(var n=0;n<h.length;n++)if(h[n].title==e){t=h[n].group;break}}return t}function fe(e){R=new Array;for(var t=e.getEnumerator();t.moveNext();){var n=t.get_current(),i=n.get_item("ID"),r=n.get_item("Title"),s=n.get_item("UserGroup");s!=null?s=s.get_lookupValue():s="";var o=new Object;o.ID=i,o.title=r,o.userGroup=s,R.push(o)}}function me(e){var t=null;if(R!=null)for(var n=0;n<R.length;n++){var i=R[n];if(i.title==e){t=i.userGroup;break}}return t}function pe(e,t,n){if(e==null||t==""||t==null||n==null)return!1;var i=!1,r=e.get_roleAssignments();if(r==null)return alert("Error retrieving role assignments"),!1;for(var s=r.getEnumerator();s.moveNext();){var o=s.get_current();if(o!=null){var a=o.get_member();if(a.isPropertyAvailable("Title")){var l=a.get_title(),u=o.get_roleDefinitionBindings();if(u!=null)for(var c=u.getEnumerator();c.moveNext();){var d=c.get_current(),p=d.get_name();if(l==t&&d.get_basePermissions().has(n)){i=!0;break}}}}}return i}function ve(e,t){if(!t){var n=!1;$("#ddlResponsesOpen > option").each(function(){if($(this).text()==e)return n=!0,notifyId=SP.UI.Notify.addNotification("Displaying Response ("+e+")",!1),$("#ddlResponsesOpen").val(e).change(),!1}),n||$("#ddlResponsesProcessed > option").each(function(){if($(this).text()==e)return n=!0,notifyId=SP.UI.Notify.addNotification("Displaying Response ("+e+")",!1),$("#ddlResponsesProcessed").val(e).change(),!1}),$("#tabs").tabs({active:1})}}function ge(e){var t={};return e=="Archived"?t={"background-color":"Gainsboro"}:e=="Approved"?t={"background-color":"PaleGreen"}:e=="Rejected"?t={"background-color":"LightSalmon"}:e=="Sent to QA"?t={"background-color":"LightCyan"}:e=="Submitted"?t={"background-color":"LemonChiffon"}:e=="Marked for Deletion"&&(t={"background-color":"Gainsboro","font-style":"italic"}),t}function he(e){var t="";return e=="Archived"?t=" style='background-color:Gainsboro;' ":e=="Approved"?t=" style='background-color:PaleGreen;' ":e=="Rejected"?t=" style='background-color:LightSalmon;' ":e=="Sent to QA"?t=" style='background-color:LightCyan;' ":e=="Submitted"?t=" style='background-color:LemonChiffon;' ":e=="Marked for Deletion"&&(t=" style='background-color:Gainsboro; font-style:italic' title='Marked for Deletion by the Action Office' "),t}function Re(e,t){for(var n=!1,i=e.getEnumerator();i.moveNext();){var r=i.get_current(),s=r.get_displayName();if(s==t){var n=!0;break}}return n}var b=0,w=0;function Ae(e,t,n,i){b=0,w=0;var r=new SP.ClientContext.get_current,s=r.get_web(),o=new SP.ListItemCreationInformation;o.set_underlyingObjectType(SP.FileSystemObjectType.folder),o.set_leafName(t),oNewEmailFolder=e.addItem(o),oNewEmailFolder.set_item("Title",t),oNewEmailFolder.update(),this.currentUser=s.get_currentUser(),this.ownerGroup=s.get_associatedOwnerGroup(),this.memberGroup=s.get_associatedMemberGroup(),this.visitorGroup=s.get_associatedVisitorGroup(),oNewEmailFolder.resetRoleInheritance(),oNewEmailFolder.breakRoleInheritance(!1,!1);var a=SP.RoleDefinitionBindingCollection.newObject(r);a.add(s.get_roleDefinitions().getByType(SP.RoleType.administrator));var l=SP.RoleDefinitionBindingCollection.newObject(r);l.add(s.get_roleDefinitions().getByType(SP.RoleType.contributor));var u=SP.RoleDefinitionBindingCollection.newObject(r);u.add(s.get_roleDefinitions().getByName("Restricted Read"));var c=SP.RoleDefinitionBindingCollection.newObject(r);c.add(s.get_roleDefinitions().getByName("Restricted Contribute")),oNewEmailFolder.get_roleAssignments().add(ownerGroup,a),oNewEmailFolder.get_roleAssignments().add(memberGroup,l),oNewEmailFolder.get_roleAssignments().add(visitorGroup,u);var d=Audit.Common.Utilities.GetSPSiteGroup(Audit.Common.Utilities.GetGroupNameQA());d!=null&&oNewEmailFolder.get_roleAssignments().add(d,c),oNewEmailFolder.get_roleAssignments().getByPrincipal(currentUser).deleteObject();function p(){if(this.requestItem){var m=this.requestItem.get_item("ActionOffice");if(m==null||m.length==0){this.OnComplete&&this.OnComplete(!0);return}for(var y=0;y<m.length;y++){var Me=m[y].get_lookupValue(),qe=Audit.Common.Utilities.GetAOSPGroupName(Me),F=Audit.Common.Utilities.GetSPSiteGroup(qe);if(F!=null){let L=function(){w++,w==b&&this.OnComplete&&this.OnComplete(!0)},I=function(Je,Ze){w++,w==b&&this.OnComplete&&this.OnComplete(!0)};var Ye=L,We=I;b++;var D=new SP.ClientContext.get_current,He=D.get_web(),O=SP.RoleDefinitionBindingCollection.newObject(D);O.add(He.get_roleDefinitions().getByName("Restricted Contribute")),this.oNewEmailFolder.get_roleAssignments().add(F,O);var P={OnComplete:this.OnComplete};D.executeQueryAsync(Function.createDelegate(P,L),Function.createDelegate(P,I))}}}else this.OnComplete&&this.OnComplete(!0)}function v(m,y){statusId=SP.UI.Status.addStatus("Request failed: "+y.get_message()+`
`+y.get_stackTrace())}var A={requestItem:n,oNewEmailFolder,OnComplete:i};r.executeQueryAsync(Function.createDelegate(A,p),Function.createDelegate(A,v))}function T(e,t){var n=e,i=t;let r,s;n==null&&(n=""),i==null&&(i="");var o=n.lastIndexOf("-");if(o>=0){var a=n.substring(0,o+1),l=n.replace(a,""),u=parseInt(l,10),c=Audit.Common.Utilities.PadDigits(u,5);r=a+c}else r=n;var d=i.lastIndexOf("-");if(d>=0){var p=i.substring(0,d+1),v=i.replace(p,""),A=parseInt(v,10),m=Audit.Common.Utilities.PadDigits(A,5);s=p+m}else s=i;return r.toLowerCase().localeCompare(s.toLowerCase())}function ye(e,t){var n=e.title,i=t.title;n==null&&(n=""),i==null&&(i="");var r=n.lastIndexOf("-");if(r>=0){var s=n.substring(0,r+1),o=n.replace(s,""),a=parseInt(o,10),l=Audit.Common.Utilities.PadDigits(a,5);newA=s+l}else newA=n;var u=i.lastIndexOf("-");if(u>=0){var c=i.substring(0,u+1),d=i.replace(c,""),p=parseInt(d,10),v=Audit.Common.Utilities.PadDigits(p,5);newB=c+v}else newB=i;return newA.toLowerCase().localeCompare(newB.toLowerCase())}function _e(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}function we(e,t){return e==""?-1:t==""?1:new Date(e).getTime()-new Date(t).getTime()}function be(e,t,n,i){if(e!=null){i?e.sort(T):n?e.sort(we):e.sort(_e);var r=new Array,s=-1;r[++s]="<option value=''>-Select-</option>";for(var o=e.length,a=0;a<o;a++){var l=$.trim(e[a]);r[++s]="<option value='"+l+"'>"+l+"</option>"}var u=$(t);u.empty().append(r.join(""))}}function Ce(e,t){if(e==null)return!1;for(var n=e.length,i=0;i<n;i++)if(e[i]==t)return!0;return!1}function Ge(e){return e==!0?"<span class='ui-icon ui-icon-check'>"+e+"</span>":"<span class='ui-icon ui-icon-close'>"+e+"</span>"}function De(e,t){var n=e.get_item(t);return n==null?"":n.get_lookupValue()}function Se(e,t){e=e.toString();var n="";if(t>e.length)for(let i=0;i<t-e.length;i++)n+="0";return n+e.toString()}function Te(e,t){var n=e>=0?1:-1;return(Math.round(e*Math.pow(10,t)+n*.001)/Math.pow(10,t)).toFixed(t)}function Ne(e){return e==null||e==""?"":(e>1048576?e=Audit.Common.Utilities.PreciseRound(e/1048576,2)+" MB":e>1024?e=Audit.Common.Utilities.PreciseRound(e/1024,2)+" KB":e+=" B",e)}function Ee(e){function t(n){return n<10?"0"+n:n}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"}function Fe(){$(".requestInfo-response-doc img").click(function(e){e.preventDefault();var t=$(this).attr("src");t=="/_layouts/images/minus.gif"?$(this).attr("src","/_layouts/images/plus.gif"):$(this).attr("src","/_layouts/images/minus.gif"),$(this).parent().parent().nextUntil("tr.requestInfo-response-doc").each(function(){$(this).toggleClass("collapsed")})})}function Oe(e){return $("select[title='"+e+"']").html()!==null?$("select[title='"+e+"']"):$("input[title='"+e+"']")}function Pe(e){return $("select[title='"+e+"']").html()!==null?$("select[title='"+e+"'] option:selected").text():$("input[title='"+e+"']").val()}function Le(e,t){try{if(t==null)return;var n=E("select","",e);if(n==null){var i=E("input","",e);ShowDropdown(i.id);var r=document.getElementById(i.opt);N(r,t),OptLoseFocus(r)}else N(n,t)}catch{}}function N(e,t){var n=e.options,i=n.length;if(e!=null){for(var r=0;r<i;r++)if(n[r].text==t)return e.selectedIndex=r,!0;return!1}}function E(e,t,n){for(var i=t.length,r=document.getElementsByTagName(e),s=0;s<r.length;s++){var o=r[s].id;if(r[s].title==n&&(t==""||o.indexOf(t)==o.length-i))return r[s]}return null}function Ie(e){var t=SP.UI.$create_DialogOptions();t.title="User Manual",t.height=250,e!=null?t.url=Audit.Common.Utilities.GetSiteUrl()+"/pages/AuditUserManuals.aspx?FilterField1=DocType&FilterValue1="+e:t.url=Audit.Common.Utilities.GetSiteUrl()+"/pages/AuditUserManuals.aspx",SP.UI.ModalDialog.showModalDialog(t)}function $e(e,t){var n=new Date,i=Audit.Common.Utilities.GetSiteUrl(),r=i+"/siteassets/css/tablesorter/style.css?v="+n.format("MM_dd_yyyy"),s=i+"/siteAssets/css/audit_styles.css?v="+n.format("MM_dd_yyyy"),o=$(t).html(),a=$("<div>").append(o);a.find(".sr-response-title a").each(function(){$(this).removeAttr("onclick"),$(this).removeAttr("href")}),o=a.html();var l=n.format("MM/dd/yyyy hh:mm tt");l="<div style='padding-bottom:10px;'>"+l+"</div>",o=l+o;var u=$("<div></div>"),c=$("<div></div>"),d=$.Deferred(),p=$.Deferred(),v="";u.load(r,function(){v+="<style>"+u.html()+"</style>",d.resolve()}),c.load(s,function(){v+="<style>"+c.html()+"</style>",p.resolve()}),$.when(d,p).done(function(){var A=`<HTML>
<HEAD>

<Title>`+e+`</Title>
`+v+`
<style>.hideOnPrint, .rowFilters {display:none}</style>
</HEAD>
<BODY>
`+o+`
</BODY>
</HTML>`,m=window.open("","printWebPart");m.document.open(),m.document.write(A),m.document.close(),m.print()})}function Ue(e,t,n){var i=ke(t);n==!0&&(i=i.slice(1));var r=xe(i);if(navigator.userAgent.search("Trident")>=0)window.CsvExpFrame.document.open("text/html","replace"),window.CsvExpFrame.document.write(r),window.CsvExpFrame.document.close(),window.CsvExpFrame.focus(),window.CsvExpFrame.document.execCommand("SaveAs",!0,e+".csv");else{var s="data:text/csv;charset=utf-8,"+escape(r),o=document.createElement("a");o.href=s,o.download=e+".csv",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}function ke(e){var t=document.getElementById(e);if(t.innerHTML.indexOf("rowFilters")>=0){var n=$("<div>").append(t.outerHTML);n.find(".rowFilters").each(function(){$(this).remove()}),t=n.find("table")[0]}if(t.innerHTML.indexOf("footer")>=0){var n=$("<div>").append(t.outerHTML);n.find(".footer").each(function(){$(this).remove()}),t=n.find("table")[0]}for(var i=[],r=0,s=t.rows.length;r<s;r++){i[r]=[];for(var o=0,a=t.rows[r].cells.length;o<a;o++){var l=t.rows[r].cells[o].textContent||t.rows[r].cells[o].innerText;i[r][o]=l.trim()}}return i}function xe(e){for(var t=typeof e!="object"?JSON.parse(e):e,n=`sep=,\r
`,i="",r,s,o=0;o<t.length;o++){i="";var a=t[o];for(r in a)a.hasOwnProperty(r)&&(s=a[r]+"",i+='"'+s.replace(/"/g,'""')+'",');i=i.slice(0,-1),n+=i+`\r
`}return n}var Be={GetSiteUrl:function(){return C=="/"?"":C},GetListTitleRequests:function(){return g},GetListNameRequests:function(){return f},GetListTitleRequestsInternal:function(){return _},GetListNameRequestsInternal:function(){return G},GetListTitleResponses:function(){return k},GetListNameResponses:function(){return x},GetLibTitleRequestDocs:function(){return B},GetLibNameRequestDocs:function(){return M},GetLibTitleCoverSheets:function(){return q},GetLibNameCoverSheets:function(){return H},GetLibTitleResponseDocs:function(){return V},GetLibNameResponseDocs:function(){return j},GetLibTitleResponseDocsEA:function(){return Q},GetLibNameResponseDocsEA:function(){return K},GetListTitleActionOffices:function(){return Y},GetListNameActionOffices:function(){return W},GetListTitleEmailHistory:function(){return J},GetListNameEmailHistory:function(){return Z},GetListTitleBulkResponses:function(){return X},GetListNameBulkResponses:function(){return z},GetListTitleBulkPermissions:function(){return ee},GetListNameBulkPermissions:function(){return te},GetGroupNameSpecialPerm1:function(){return ne},GetGroupNameSpecialPerm2:function(){return ie},GetGroupNameQA:function(){return re},GetGroupNameEA:function(){return oe},Refresh:se,OnLoadDisplayTimeStamp:ae,OnLoadDisplayTabAndResponse:le,OnLoadFilterResponses:function(e,t){ue(e,t)},SetResponseDocLibGUID:function(e){S=e},GetResponseDocLibGUID:function(){return S},LoadSiteGroups:function(e){ce(e)},GetSPSiteGroup:function(e){return de(e)},LoadActionOffices:function(e){fe(e)},GetActionOffices:function(){return R},GetAOSPGroupName:function(e){return me(e)},CheckSPItemHasGroupPermission:function(e,t,n){return pe(e,t,n)},GoToResponse:function(e,t){ve(e,t)},GetResponseDocStyleTag:function(e){return he(e)},GetResponseDocStyleTag2:function(e){return ge(e)},CheckIfEmailFolderExists:function(e,t){return Re(e,t)},CreateEmailFolder:function(e,t,n,i){return Ae(e,t,n,i)},AddOptions:function(e,t,n,i){be(e,t,n,i)},ExistsInArr:function(e,t){return Ce(e,t)},GetTrueFalseIcon:function(e){return Ge(e)},PadDigits:function(e,t){return Se(e,t)},PreciseRound:function(e,t){return Te(e,t)},GetFriendlyFileSize:function(e){return Ne(e)},GetISODateString:function(e){return Ee(e)},GetFriendlyDisplayName:function(e,t){return De(e,t)},BindHandlerResponseDoc:Fe,PrintStatusReport:function(e,t){$e(e,t)},ExportToCsv:function(e,t,n){Ue(e,t,n)},ViewUserManuals:function(e){Ie(e)},GetLookupDisplayText:function(e){return Pe(e)},GetLookupFormField:function(e){return Oe(e)},SetLookupFromFieldNameByText:function(e,t){return Le(e,t)},SortResponseObjects:function(e,t){return ye(e,t)},SortResponseTitles:T};return Be};Ve();window.Audit=window.Audit||{};Audit.EAReport=Audit.EAReport||{};var je=String.raw,Qe=je`
  <div class="audit">
    <div style="padding-bottom: 10px">
      <a
        title="Refresh this page"
        href="javascript:void(0)"
        onclick="Audit.Common.Utilities.Refresh()"
        ><span class="ui-icon ui-icon-refresh"></span>Refresh</a
      >
      <span id="lblFilteredOn" style="padding-left: 10px"></span>
    </div>

    <div id="divExplorerView"></div>
  </div>
`;document.getElementById("app").innerHTML=Qe;var Ke=GetUrlKeyValue("ShowSiteActions");Ke!=!0;document.readyState==="ready"||document.readyState==="complete"?U():document.onreadystatechange=()=>{(document.readyState==="complete"||document.readyState==="ready")&&U()};function U(){Audit.EAReport.Report=new Audit.EAReport.NewReportPage,Audit.EAReport.Init()}Audit.EAReport.Init=function(){};Audit.EAReport.NewReportPage=function(){var C=location.protocol+"//"+location.host+Audit.Common.Utilities.GetSiteUrl()+"/"+Audit.Common.Utilities.GetLibTitleResponseDocsEA(),g=GetUrlKeyValue("FilterField1"),f=GetUrlKeyValue("FilterValue1");if(g=="Modified"&&f!=null&&f!=""){f=f.replace(/%2D/g,"/"),f=f.replace(/-/g,"/");var _=new Date(f);_=_.format("M/d/yyyy"),document.getElementById("lblFilteredOn").innerHTML="Filtered Documents (<b>"+g+"</b> = <b>"+_+"</b>)"}else g!=null&&g!=""&&f!=null&&f!=""?document.getElementById("lblFilteredOn").innerHTML="Filtered Documents (<b>"+g+"</b> = <b>"+f+"</b>)":document.getElementById("lblFilteredOn").innerHTML="";var G={};return G};})();
