(()=>{window.Audit=window.Audit||{};Audit.Common=Audit.Common||{};function He(){Audit.Common.Utilities=new Audit.Common.NewUtilities,Audit.Common.Init()}Audit.Common.Init=function(){};Audit.Common.NewUtilities=function(){var z=_spPageContextInfo.webServerRelativeUrl,B="AuditRequests",ge="AuditRequests",he="AuditRequestsInternal",_e="AuditRequestsInternal",S="AuditResponses",Q="AuditResponses",M="AuditRequestDocs",ae="AuditRequestDocs",re="AuditCoverSheets",oe="AuditCoverSheets",le="AuditResponseDocs",j="AuditResponseDocs",q="AuditResponseDocsEA",F="AuditResponseDocsEA",V="AuditOrganizations",ie="AuditOrganizations",ue="AuditEmails",se="AuditEmails",K="AuditBulkResponses",k="AuditBulkResponses",I="AuditBulkPermissions",de="AuditBulkPermissions",ce="CGFS Special Access1",fe="CGFS Special Access2",me="Quality Assurance",o="External Auditors",l=null,d=null,u=null;function v(e=!1){if(e){location.href=location.pathname;return}var t=location.pathname;if($("#tabs").html()!=null&&$("#tabs").html()!=""){var n=0;try{n=$("#tabs").tabs("option","active")}catch{}if(t+="?Tab="+n,n==0&&$("#ddlResponseName").val()!="")t+="&ResNum="+$("#ddlResponseName").val();else if(n==1){var r=$("#ddlResponsesOpen").val(),i=$("#ddlResponsesProcessed").val();r!=null&&r!=""?t+="&ResNum="+r:i!=null&&i!=""&&(t+="&ResNum="+i)}location.href=t}else location.reload()}function R(){var e=new Date;$("#divLoading").text("Loaded at "+e.format("MM/dd/yyyy hh:mm tt"))}function h(){var e=GetUrlKeyValue("Tab");e!=null&&e!=""&&$("#tabs").tabs("option","active",e);var t=!1,n=GetUrlKeyValue("ResNum");n!=null&&n!=""&&(e==0?$("#ddlResponseName option[value='"+n+"']").length>0&&($("#ddlResponseName").val(n).change(),t=!0):$("#ddlResponsesOpen option[value='"+n+"']").length>0?$("#ddlResponsesOpen").val(n).change():$("#ddlResponsesProcessed option[value='"+n+"']").length>0&&$("#ddlResponsesProcessed").val(n).change()),t||$(".sr-response-item").show()}function _(e,t){var n=0,r=0,i=0,a=0,s=0,f=$(".sr-response-item");f.each(function(){var p=$.trim($(this).find(".sr-response-requestStatus").text()),g=$.trim($(this).find(".sr-response-status").text());(g==e||g==t)&&(p=="Open"||p=="ReOpened")&&($(this).addClass("highlighted"),n++,g==e?a++:g==t&&s++,p=="Open"?r++:p=="ReOpened"&&i++)}),n>0?($("#lblStatusReportResponsesMsg").html("<span class='ui-icon ui-icon-alert'></span>There are "+n+" Responses pending your review"),a>0&&s==0?$("#ddlResponseStatus").val(e).change():s>0&&a==0&&$("#ddlResponseStatus").val(t).change()):$("#lblStatusReportResponsesMsg").html("<span class='ui-icon ui-icon-circle-check'></span>There are 0 Responses pending your review")}function C(e){d=new Array;for(var t=e.getEnumerator();t.moveNext();){var n=t.get_current(),r=n.get_id(),i=n.get_loginName(),a=n.get_title(),s=new Object;s.ID=r,s.loginName=i,s.title=a,s.group=n,d.push(s)}}function A(e){var t=null;if(d!=null){for(var n=0;n<d.length;n++)if(d[n].title==e){t=d[n].group;break}}return t}function w(e){u=new Array;for(var t=e.getEnumerator();t.moveNext();){var n=t.get_current(),r=n.get_item("ID"),i=n.get_item("Title"),a=n.get_item("UserGroup");a!=null?a=a.get_lookupValue():a="";var s=new Object;s.ID=r,s.title=i,s.userGroup=a,u.push(s)}}function m(e){var t=null;if(u!=null)for(var n=0;n<u.length;n++){var r=u[n];if(r.title==e){t=r.userGroup;break}}return t}function y(e,t,n){if(e==null||t==""||t==null||n==null)return!1;var r=!1,i=e.get_roleAssignments();if(i==null)return alert("Error retrieving role assignments"),!1;for(var a=i.getEnumerator();a.moveNext();){var s=a.get_current();if(s!=null){var f=s.get_member();if(f.isPropertyAvailable("Title")){var p=f.get_title(),g=s.get_roleDefinitionBindings();if(g!=null)for(var N=g.getEnumerator();N.moveNext();){var P=N.get_current(),O=P.get_name();if(p==t&&P.get_basePermissions().has(n)){r=!0;break}}}}}return r}function G(e,t){if(!t){var n=!1;$("#ddlResponsesOpen > option").each(function(){if($(this).text()==e)return n=!0,notifyId=SP.UI.Notify.addNotification("Displaying Response ("+e+")",!1),$("#ddlResponsesOpen").val(e).change(),!1}),n||$("#ddlResponsesProcessed > option").each(function(){if($(this).text()==e)return n=!0,notifyId=SP.UI.Notify.addNotification("Displaying Response ("+e+")",!1),$("#ddlResponsesProcessed").val(e).change(),!1}),$("#tabs").tabs({active:1})}}function U(e){var t={};return e=="Archived"?t={"background-color":"Gainsboro"}:e=="Approved"?t={"background-color":"PaleGreen"}:e=="Rejected"?t={"background-color":"LightSalmon"}:e=="Sent to QA"?t={"background-color":"LightCyan"}:e=="Submitted"?t={"background-color":"LemonChiffon"}:e=="Marked for Deletion"&&(t={"background-color":"Gainsboro","font-style":"italic"}),t}function H(e){var t="";return e=="Archived"?t=" style='background-color:Gainsboro;' ":e=="Approved"?t=" style='background-color:PaleGreen;' ":e=="Rejected"?t=" style='background-color:LightSalmon;' ":e=="Sent to QA"?t=" style='background-color:LightCyan;' ":e=="Submitted"?t=" style='background-color:LemonChiffon;' ":e=="Marked for Deletion"&&(t=" style='background-color:Gainsboro; font-style:italic' title='Marked for Deletion by the Action Office' "),t}function Y(e,t){for(var n=!1,r=e.getEnumerator();r.moveNext();){var i=r.get_current(),a=i.get_displayName();if(a==t){var n=!0;break}}return n}var D=0,c=0;function E(e,t,n,r){D=0,c=0;var i=new SP.ClientContext.get_current,a=i.get_web(),s=new SP.ListItemCreationInformation;s.set_underlyingObjectType(SP.FileSystemObjectType.folder),s.set_leafName(t),oNewEmailFolder=e.addItem(s),oNewEmailFolder.set_item("Title",t),oNewEmailFolder.update(),this.currentUser=a.get_currentUser(),this.ownerGroup=a.get_associatedOwnerGroup(),this.memberGroup=a.get_associatedMemberGroup(),this.visitorGroup=a.get_associatedVisitorGroup(),oNewEmailFolder.resetRoleInheritance(),oNewEmailFolder.breakRoleInheritance(!1,!1);var f=SP.RoleDefinitionBindingCollection.newObject(i);f.add(a.get_roleDefinitions().getByType(SP.RoleType.administrator));var p=SP.RoleDefinitionBindingCollection.newObject(i);p.add(a.get_roleDefinitions().getByType(SP.RoleType.contributor));var g=SP.RoleDefinitionBindingCollection.newObject(i);g.add(a.get_roleDefinitions().getByName("Restricted Read"));var N=SP.RoleDefinitionBindingCollection.newObject(i);N.add(a.get_roleDefinitions().getByName("Restricted Contribute")),oNewEmailFolder.get_roleAssignments().add(ownerGroup,f),oNewEmailFolder.get_roleAssignments().add(memberGroup,p),oNewEmailFolder.get_roleAssignments().add(visitorGroup,g);var P=Audit.Common.Utilities.GetSPSiteGroup(Audit.Common.Utilities.GetGroupNameQA());P!=null&&oNewEmailFolder.get_roleAssignments().add(P,N),oNewEmailFolder.get_roleAssignments().getByPrincipal(currentUser).deleteObject();function O(){if(this.requestItem){var T=this.requestItem.get_item("ActionOffice");if(T==null||T.length==0){this.OnComplete&&this.OnComplete(!0);return}for(var Z=0;Z<T.length;Z++){var Me=T[Z].get_lookupValue(),qe=Audit.Common.Utilities.GetAOSPGroupName(Me),be=Audit.Common.Utilities.GetSPSiteGroup(qe);if(be!=null){let Ce=function(){c++,c==D&&this.OnComplete&&this.OnComplete(!0)},Ae=function(Ye,We){c++,c==D&&this.OnComplete&&this.OnComplete(!0)};var je=Ce,Ke=Ae;D++;var ve=new SP.ClientContext.get_current,Ve=ve.get_web(),Ue=SP.RoleDefinitionBindingCollection.newObject(ve);Ue.add(Ve.get_roleDefinitions().getByName("Restricted Contribute")),this.oNewEmailFolder.get_roleAssignments().add(be,Ue);var Re={OnComplete:this.OnComplete};ve.executeQueryAsync(Function.createDelegate(Re,Ce),Function.createDelegate(Re,Ae))}}}else this.OnComplete&&this.OnComplete(!0)}function x(T,Z){statusId=SP.UI.Status.addStatus("Request failed: "+Z.get_message()+`
`+Z.get_stackTrace())}var X={requestItem:n,oNewEmailFolder,OnComplete:r};i.executeQueryAsync(Function.createDelegate(X,O),Function.createDelegate(X,x))}function L(e,t){var n=e,r=t;let i,a;n==null&&(n=""),r==null&&(r="");var s=n.lastIndexOf("-");if(s>=0){var f=n.substring(0,s+1),p=n.replace(f,""),g=parseInt(p,10),N=Audit.Common.Utilities.PadDigits(g,5);i=f+N}else i=n;var P=r.lastIndexOf("-");if(P>=0){var O=r.substring(0,P+1),x=r.replace(O,""),X=parseInt(x,10),T=Audit.Common.Utilities.PadDigits(X,5);a=O+T}else a=r;return i.toLowerCase().localeCompare(a.toLowerCase())}function b(e,t){var n=e.title,r=t.title;n==null&&(n=""),r==null&&(r="");var i=n.lastIndexOf("-");if(i>=0){var a=n.substring(0,i+1),s=n.replace(a,""),f=parseInt(s,10),p=Audit.Common.Utilities.PadDigits(f,5);newA=a+p}else newA=n;var g=r.lastIndexOf("-");if(g>=0){var N=r.substring(0,g+1),P=r.replace(N,""),O=parseInt(P,10),x=Audit.Common.Utilities.PadDigits(O,5);newB=N+x}else newB=r;return newA.toLowerCase().localeCompare(newB.toLowerCase())}function W(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}function ee(e,t){return e==""?-1:t==""?1:new Date(e).getTime()-new Date(t).getTime()}function te(e,t,n,r){if(e!=null){r?e.sort(L):n?e.sort(ee):e.sort(W);var i=new Array,a=-1;i[++a]="<option value=''>-Select-</option>";for(var s=e.length,f=0;f<s;f++){var p=$.trim(e[f]);i[++a]="<option value='"+p+"'>"+p+"</option>"}var g=$(t);g.empty().append(i.join(""))}}function J(e,t){if(e==null)return!1;for(var n=e.length,r=0;r<n;r++)if(e[r]==t)return!0;return!1}function pe(e){return e==!0?"<span class='ui-icon ui-icon-check'>"+e+"</span>":"<span class='ui-icon ui-icon-close'>"+e+"</span>"}function ne(e,t){var n=e.get_item(t);return n==null?"":n.get_lookupValue()}function Ge(e,t){e=e.toString();var n="";if(t>e.length)for(let r=0;r<t-e.length;r++)n+="0";return n+e.toString()}function De(e,t){var n=e>=0?1:-1;return(Math.round(e*Math.pow(10,t)+n*.001)/Math.pow(10,t)).toFixed(t)}function Ne(e){return e==null||e==""?"":(e>1048576?e=Audit.Common.Utilities.PreciseRound(e/1048576,2)+" MB":e>1024?e=Audit.Common.Utilities.PreciseRound(e/1024,2)+" KB":e+=" B",e)}function Pe(e){function t(n){return n<10?"0"+n:n}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"}function $e(){$(".requestInfo-response-doc img").click(function(e){e.preventDefault();var t=$(this).attr("src");t=="/_layouts/images/minus.gif"?$(this).attr("src","/_layouts/images/plus.gif"):$(this).attr("src","/_layouts/images/minus.gif"),$(this).parent().parent().nextUntil("tr.requestInfo-response-doc").each(function(){$(this).toggleClass("collapsed")})})}function Ie(e){return $("select[title='"+e+"']").html()!==null?$("select[title='"+e+"']"):$("input[title='"+e+"']")}function Te(e){return $("select[title='"+e+"']").html()!==null?$("select[title='"+e+"'] option:selected").text():$("input[title='"+e+"']").val()}function Le(e,t){try{if(t==null)return;var n=ye("select","",e);if(n==null){var r=ye("input","",e);ShowDropdown(r.id);var i=document.getElementById(r.opt);we(i,t),OptLoseFocus(i)}else we(n,t)}catch{}}function we(e,t){var n=e.options,r=n.length;if(e!=null){for(var i=0;i<r;i++)if(n[i].text==t)return e.selectedIndex=i,!0;return!1}}function ye(e,t,n){for(var r=t.length,i=document.getElementsByTagName(e),a=0;a<i.length;a++){var s=i[a].id;if(i[a].title==n&&(t==""||s.indexOf(t)==s.length-r))return i[a]}return null}function Oe(e){var t=SP.UI.$create_DialogOptions();t.title="User Manual",t.height=250,e!=null?t.url=Audit.Common.Utilities.GetSiteUrl()+"/pages/AuditUserManuals.aspx?FilterField1=DocType&FilterValue1="+e:t.url=Audit.Common.Utilities.GetSiteUrl()+"/pages/AuditUserManuals.aspx",SP.UI.ModalDialog.showModalDialog(t)}function Fe(e,t){var n=new Date,r=Audit.Common.Utilities.GetSiteUrl(),i=r+"/siteassets/css/tablesorter/style.css?v="+n.format("MM_dd_yyyy"),a=r+"/siteAssets/css/audit_styles.css?v="+n.format("MM_dd_yyyy"),s=$(t).html(),f=$("<div>").append(s);f.find(".sr-response-title a").each(function(){$(this).removeAttr("onclick"),$(this).removeAttr("href")}),s=f.html();var p=n.format("MM/dd/yyyy hh:mm tt");p="<div style='padding-bottom:10px;'>"+p+"</div>",s=p+s;var g=$("<div></div>"),N=$("<div></div>"),P=$.Deferred(),O=$.Deferred(),x="";g.load(i,function(){x+="<style>"+g.html()+"</style>",P.resolve()}),N.load(a,function(){x+="<style>"+N.html()+"</style>",O.resolve()}),$.when(P,O).done(function(){var X=`<HTML>
<HEAD>

<Title>`+e+`</Title>
`+x+`
<style>.hideOnPrint, .rowFilters {display:none}</style>
</HEAD>
<BODY>
`+s+`
</BODY>
</HTML>`,T=window.open("","printWebPart");T.document.open(),T.document.write(X),T.document.close(),T.print()})}function ke(e,t,n){var r=Ee(t);n==!0&&(r=r.slice(1));var i=xe(r);if(navigator.userAgent.search("Trident")>=0)window.CsvExpFrame.document.open("text/html","replace"),window.CsvExpFrame.document.write(i),window.CsvExpFrame.document.close(),window.CsvExpFrame.focus(),window.CsvExpFrame.document.execCommand("SaveAs",!0,e+".csv");else{var a="data:text/csv;charset=utf-8,"+escape(i),s=document.createElement("a");s.href=a,s.download=e+".csv",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}function Ee(e){var t=document.getElementById(e);if(t.innerHTML.indexOf("rowFilters")>=0){var n=$("<div>").append(t.outerHTML);n.find(".rowFilters").each(function(){$(this).remove()}),t=n.find("table")[0]}if(t.innerHTML.indexOf("footer")>=0){var n=$("<div>").append(t.outerHTML);n.find(".footer").each(function(){$(this).remove()}),t=n.find("table")[0]}for(var r=[],i=0,a=t.rows.length;i<a;i++){r[i]=[];for(var s=0,f=t.rows[i].cells.length;s<f;s++){var p=t.rows[i].cells[s].textContent||t.rows[i].cells[s].innerText;r[i][s]=p.trim()}}return r}function xe(e){for(var t=typeof e!="object"?JSON.parse(e):e,n=`sep=,\r
`,r="",i,a,s=0;s<t.length;s++){r="";var f=t[s];for(i in f)f.hasOwnProperty(i)&&(a=f[i]+"",r+='"'+a.replace(/"/g,'""')+'",');r=r.slice(0,-1),n+=r+`\r
`}return n}var Be={GetSiteUrl:function(){return z=="/"?"":z},GetListTitleRequests:function(){return B},GetListNameRequests:function(){return ge},GetListTitleRequestsInternal:function(){return he},GetListNameRequestsInternal:function(){return _e},GetListTitleResponses:function(){return S},GetListNameResponses:function(){return Q},GetLibTitleRequestDocs:function(){return M},GetLibNameRequestDocs:function(){return ae},GetLibTitleCoverSheets:function(){return re},GetLibNameCoverSheets:function(){return oe},GetLibTitleResponseDocs:function(){return le},GetLibNameResponseDocs:function(){return j},GetLibTitleResponseDocsEA:function(){return q},GetLibNameResponseDocsEA:function(){return F},GetListTitleActionOffices:function(){return V},GetListNameActionOffices:function(){return ie},GetListTitleEmailHistory:function(){return ue},GetListNameEmailHistory:function(){return se},GetListTitleBulkResponses:function(){return K},GetListNameBulkResponses:function(){return k},GetListTitleBulkPermissions:function(){return I},GetListNameBulkPermissions:function(){return de},GetGroupNameSpecialPerm1:function(){return ce},GetGroupNameSpecialPerm2:function(){return fe},GetGroupNameQA:function(){return me},GetGroupNameEA:function(){return o},Refresh:v,OnLoadDisplayTimeStamp:R,OnLoadDisplayTabAndResponse:h,OnLoadFilterResponses:function(e,t){_(e,t)},SetResponseDocLibGUID:function(e){l=e},GetResponseDocLibGUID:function(){return l},LoadSiteGroups:function(e){C(e)},GetSPSiteGroup:function(e){return A(e)},LoadActionOffices:function(e){w(e)},GetActionOffices:function(){return u},GetAOSPGroupName:function(e){return m(e)},CheckSPItemHasGroupPermission:function(e,t,n){return y(e,t,n)},GoToResponse:function(e,t){G(e,t)},GetResponseDocStyleTag:function(e){return H(e)},GetResponseDocStyleTag2:function(e){return U(e)},CheckIfEmailFolderExists:function(e,t){return Y(e,t)},CreateEmailFolder:function(e,t,n,r){return E(e,t,n,r)},AddOptions:function(e,t,n,r){te(e,t,n,r)},ExistsInArr:function(e,t){return J(e,t)},GetTrueFalseIcon:function(e){return pe(e)},PadDigits:function(e,t){return Ge(e,t)},PreciseRound:function(e,t){return De(e,t)},GetFriendlyFileSize:function(e){return Ne(e)},GetISODateString:function(e){return Pe(e)},GetFriendlyDisplayName:function(e,t){return ne(e,t)},BindHandlerResponseDoc:$e,PrintStatusReport:function(e,t){Fe(e,t)},ExportToCsv:function(e,t,n){ke(e,t,n)},ViewUserManuals:function(e){Oe(e)},GetLookupDisplayText:function(e){return Te(e)},GetLookupFormField:function(e){return Ie(e)},SetLookupFromFieldNameByText:function(e,t){return Le(e,t)},SortResponseObjects:function(e,t){return b(e,t)},SortResponseTitles:L};return Be};He();window.Audit=window.Audit||{};Audit.BulkUpdateUsers=Audit.BulkUpdateUsers||{};var Qe=String.raw;document.getElementById("app").innerHTML=Qe`
  <div class="audit">
    <div id="divLoadSettings" style="display: none">
      <fieldset>
        <legend>Update SharePoint Group Users</legend>
        <div style="padding-top: 10px">
          <a href="javascript:void" id="btnUploadUsers"
            ><span class="ui-icon ui-icon-gear"></span>Click Here to Upload
            Users</a
          >
        </div>
        <div style="padding-top: 10px">
          <a href="javascript:void" id="btnLoadUsers" style="display: none"
            >Click Here to Display Uploaded Users</a
          >
        </div>
      </fieldset>
    </div>
    <div id="tblUnfoundUsers" style="padding-top: 15px; color: red"></div>
    <div id="divLoadBulkUsersOutput" style="padding-top: 15px"></div>
    <div style="padding-top: 15px">
      <a
        href="javascript:void"
        id="btnCreateUsers"
        style="display: none"
        title="Click here to Update Site Groups"
        ><span class="ui-icon ui-icon-disk"></span>Click Here to Create
        SharePoint Groups or Update the SharePoint Groups with the Users
        Listed</a
      >
    </div>
  </div>
`;document.readyState==="ready"||document.readyState==="complete"?Se():document.onreadystatechange=()=>{(document.readyState==="complete"||document.readyState==="ready")&&ExecuteOrDelayUntilScriptLoaded(function(){SP.SOD.executeFunc("sp.js","SP.ClientContext",Se)},"sp.js")};function Se(){Audit.BulkUpdateUsers.Report=new Audit.BulkUpdateUsers.Load,Audit.BulkUpdateUsers.Init()}Audit.BulkUpdateUsers.Init=function(){};Audit.BulkUpdateUsers.Load=function(){var z=null,B=new Array,ge=null,he=null,_e=null,S,Q,M;ae();function ae(){$("#divTblOutput").html("");var o=new SP.ClientContext.get_current,l=o.get_web();Q=o.get_web().get_siteGroups(),o.load(Q),o.load(Q,"Include(Users)");var d=o.get_web().get_lists().getByTitle(Audit.Common.Utilities.GetListNameBulkPermissions()),u=d.get_views().getByTitle("All Items");o.load(u),o.executeQueryAsync(v,R);function v(h,_){z=u.get_id(),re(Q),$("#divLoadSettings").show(),ce();var C=GetUrlKeyValue("IsDlg");(C==null||C==""||C==!1)&&$("#btnRefresh").show()}function R(h,_){$("#divLoading").hide(),statusId=SP.UI.Status.addStatus("Request failed: "+_.get_message()+`
`+_.get_stackTrace()),SP.UI.Status.setStatusPriColor(statusId,"red")}}function re(o){B=new Array;for(var l=o.getEnumerator();l.moveNext();){var d=l.get_current(),u=d.get_title();u=$.trim(u);for(var v=d.get_id(),R=new Array,h=d.get_users().getEnumerator();h.moveNext();){var _=h.get_current(),C=_.get_loginName();R.push(C)}R.sort();for(var A="",w=0;w<R.length;w++)A+=R[w]+";";var m=new Object;m.Title=u.toLowerCase(),m.Users=A,m.SPGroupID=v,B.push(m)}}function oe(){var o=location.pathname,l=$("#tabs").tabs("option","active");o+="?Tab="+l,location.href=o}function le(){var o=SP.UI.$create_DialogOptions();o.title="Upload Users",o.dialogReturnValueCallback=fe;var l=z.toString();l=l.replace(/-/g,"%2D"),l=l.toUpperCase(),o.url=Audit.Common.Utilities.GetSiteUrl()+"/Lists/"+Audit.Common.Utilities.GetListNameBulkPermissions()+"/AllItems.aspx?ShowInGrid=True&View=%7B"+l+"%7D",o.height=700,SP.UI.ModalDialog.showModalDialog(o)}var j=0,q=0,F="",V=null;function ie(){S=new Array;var o=new SP.ClientContext.get_current,l=o.get_web(),d=l.get_lists().getByTitle(Audit.Common.Utilities.GetListTitleBulkPermissions()),u=new SP.CamlQuery;u.set_viewXml('<View><Query><OrderBy><FieldRef Name="Title"/></OrderBy></Query></View>');var v=d.getItems(u);o.load(v,"Include(ID, Title, UserNames)");function R(_,C){for(var A=v.getEnumerator();A.moveNext();){var w=A.get_current(),m=w.get_item("ID"),y=w.get_item("Title");y!=null&&(y=$.trim(y));var G=w.get_item("UserNames"),U=new Object;U.ID=m,U.groupName=y,U.newUserNames=G,U.existingUserNames=null;var H=!0,Y=null;if(H){for(var D=!1,c=0;c<B.length;c++)if(B[c].Title==y.toLowerCase()){U.existingUserNames=B[c].Users,U.SPGroupID=B[c].SPGroupID,D=!0;break}D||(H=!1,Y="SharePoint Group not found. An attempt to create it will be made when clicking save below")}U.isValid=H,U.invalidReason=Y,S.push(U)}for(var E=!1,L="<table class='tablesorter report' id='outputTable'><tr><thead><th>SharePoint Group</th><th>Current User Names</th><th>Replace Users with</th></thead></tr>",c=0;c<S.length;c++){var b=S[c];b.isValid?(L+="<tr id='tableRow"+c+"'><td id='tdGroup"+c+"'>"+b.groupName+"</td><td>"+K(b.existingUserNames)+"</td><td>"+K(b.newUserNames)+"</td></tr>",E=!0):L+="<tr id='tableRow"+c+"' style='background-color:lemonchiffon; font-style:italic;' title='"+b.invalidReason+"'><td>"+b.groupName+" - "+b.invalidReason+"</td><td>"+K(b.existingUserNames)+"</td><td>"+K(b.newUserNames)+"</td></tr>"}if($("#divLoadBulkUsersOutput").html(L+="</table>"),S.length==0){$("#divLoadBulkUsersOutput").html("");return}$("#btnCreateUsers").show(),$("#tblUnfoundUsers").html(""),ue()}function h(_,C){statusId=SP.UI.Status.addStatus("Unable to load from the Bulk Upload List: "+C.get_message()+`
`+C.get_stackTrace()),SP.UI.Status.setStatusPriColor(statusId,"red")}o.executeQueryAsync(R,h)}function ue(){j=0,q=0,F=$("#divLoadBulkUsersOutput").html(),V=new Array;for(var o=0;o<S.length;o++){var l=S[o];if(l.isValid){var d=null;if(l.newUserNames&&(d=l.newUserNames.split(";")),d)for(var u=0;u<d.length;u++){let C=function(w,m){if(q++,this.result&&this.result.get_loginName()!=null&&this.result.get_loginName()!="")var y=this.result.get_loginName(),G=this.userDisplayName;else{var G=this.userDisplayName,U=$("#tblUnfoundUsers").html();U+="<div>"+G+"</div>",$("#tblUnfoundUsers").html()==""?$("#tblUnfoundUsers").html("<div>These users were not found and will be skipped:</div>"+U):$("#tblUnfoundUsers").html(U),F=F.split("<LI>"+G+"</LI>").join(""),V.push(G)}j==q&&($("#divLoadBulkUsersOutput").html(F),se())},A=function(w,m){var y=this.userDisplayName,G=$("#tblUnfoundUsers").html();G+="<div>"+y+"</div>",$("#tblUnfoundUsers").html(G),F=F.split("<LI>"+y+"</LI>").join(""),V.push(y),q++,j==q&&($("#divLoadBulkUsersOutput").html(F),se()),alert(error)};j++;var v=new SP.ClientContext.get_current,R=v.get_web(),h=d[u];h=$.trim(h),result=SP.Utilities.Utility.resolvePrincipal(v,R,h,SP.Utilities.PrincipalType.user,SP.Utilities.PrincipalSource.all,null,!1);var _={userDisplayName:h,result};v.executeQueryAsync(Function.createDelegate(_,C),Function.createDelegate(_,A))}}}}function se(){for(var o=0;o<V.length;o++){var l=V[o];if(l=$.trim(l),l!=null&&l!="")for(var d=0;d<S.length;d++){var u=S[d];u.isValid&&(u.newUserNames=u.newUserNames.split(l+";").join(""),u.newUserNames=u.newUserNames.split(l).join(""))}}}function K(o){if(o==null||o=="")return"";o=o.replace(/; /gi,";");var l=o.split(";");l=l.sort();for(var d="<ul>",u=0;u<l.length;u++)l[u]!=null&&$.trim(l[u])&&(d+="<li>"+l[u]+"</li>");return d+="</ul>",d}var k=0,I=0;function de(){if(confirm("Are you sure you would like to Create or Update the SharePoint Groups? If Creating a Group, please re-run after the operation completed. If updating a Group, this action will replace ALL existing users in the Groups")){$("#btnCreateUsers").hide(),document.body.style.cursor="wait",M=SP.UI.Notify.addNotification("Please wait... ",!1);for(var o=0;o<S.length;o++){var l=S[o];if(!l.isValid){let U=function(Y,D){var c=new SP.ClientContext.get_current,E=v.add(this.group),L=u.get_roleDefinitions().getByName("Restricted Read"),b=SP.RoleDefinitionBindingCollection.newObject(c);b.add(L);var W=u.get_roleAssignments();W.add(E,b),E.set_allowMembersEditMembership(!1),E.set_onlyAllowMembersViewMembership(!1),E.set_owner(c.get_web().get_associatedOwnerGroup()),E.update(),v=c.get_web().get_siteGroups(),c.load(v),c.load(v,"Include(Users)");function ee(pe,ne){I++,$("#tableRow"+this.tableRowId).attr("style","background-color:palegreen"),$("#tableRow"+this.tableRowId).attr("title","Created SharePoint Group. Please run again to add users"),$("#tdGroup"+this.tableRowId).html("<span class='ui-icon ui-icon-check'></span> "+$("#tdGroup"+this.tableRowId).text()),k==I&&(document.body.style.cursor="default",M=SP.UI.Notify.addNotification("Completed",!1),re(this.collGroup))}function te(pe,ne){I++,$("#tableRow"+this.tableRowId).attr("style","background-color:salmon"),$("#tableRow"+this.tableRowId).attr("title",ne.get_message()),$("#tdGroup"+this.tableRowId).html($("#tdGroup"+this.tableRowId).text()+" - "+ne.get_message()),k==I&&(document.body.style.cursor="default",M=SP.UI.Notify.addNotification("Error occurred",!1))}var J={tableRowId:this.tableRowId,collGroup:v};c.executeQueryAsync(Function.createDelegate(J,ee),Function.createDelegate(J,te))},H=function(Y,D){$("#tableRow"+this.tableRowId).attr("style","background-color:salmon"),$("#tableRow"+this.tableRowId).attr("title",D.get_message()),$("#tdGroup"+this.tableRowId).html($("#tdGroup"+this.tableRowId).text()+" - "+D.get_message()),I++,k==I&&(document.body.style.cursor="default",M=SP.UI.Notify.addNotification("Completed",!1))};k++;var d=new SP.ClientContext.get_current,u=d.get_web(),v=d.get_web().get_siteGroups(),R=new SP.GroupCreationInformation;R.set_title(l.groupName);var h={tableRowId:o,group:R};d.executeQueryAsync(Function.createDelegate(h,U),Function.createDelegate(h,H))}if(l.isValid){let D=function(L,b){$("#tableRow"+this.tableRowId).attr("style","background-color:palegreen"),$("#tableRow"+this.tableRowId).attr("title","Created"),$("#tdGroup"+this.tableRowId).html("<span class='ui-icon ui-icon-check'></span> "+$("#tdGroup"+this.tableRowId).text());var W=new SP.ClientContext.get_current,ee=S[this.tableRowId].ID,te=W.get_web().get_lists().getByTitle(Audit.Common.Utilities.GetListNameBulkPermissions()),J=te.getItemById(ee);J.deleteObject(),W.executeQueryAsync(function(){},function(){}),I++,k==I&&(document.body.style.cursor="default",M=SP.UI.Notify.addNotification("Completed",!1))},c=function(L,b){$("#tableRow"+this.tableRowId).attr("style","background-color:salmon"),$("#tableRow"+this.tableRowId).attr("title",b.get_message()),$("#tdGroup"+this.tableRowId).html($("#tdGroup"+this.tableRowId).text()+" - "+b.get_message()),I++,k==I&&(document.body.style.cursor="default",M=SP.UI.Notify.addNotification("Completed",!1))};k++;var d=new SP.ClientContext.get_current,u=d.get_web(),v=u.get_siteGroups(),_=v.getById(l.SPGroupID);_.set_allowMembersEditMembership(!1),_.set_onlyAllowMembersViewMembership(!1),_.set_owner(d.get_web().get_associatedOwnerGroup()),_.update();for(var C=l.existingUserNames,A=C.split(";"),w=0;w<A.length;w++){var m=A[w];if(m!=null&&$.trim(m)!=""){m=$.trim(m);var y=u.ensureUser(m);y&&_.get_users().remove(y)}}var G=l.newUserNames;if(G!=null)for(var A=G.split(";"),w=0;w<A.length;w++){var m=A[w];if(m!=null&&$.trim(m)!=""){m=$.trim(m);var y=u.ensureUser(m);y&&_.get_users().addUser(y)}}var h={tableRowId:o};d.executeQueryAsync(Function.createDelegate(h,D),Function.createDelegate(h,c))}}}}function ce(){$("#btnUploadUsers").click(function(){le()}),$("#btnLoadUsers").click(function(){ie()}),$("#btnCreateUsers").click(function(){de()})}function fe(o,l){ie()}var me={Refresh:oe};return me};})();
